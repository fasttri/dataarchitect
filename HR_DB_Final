CREATE TABLE CITY (
  CITY_ID SERIAL PRIMARY KEY,
  STATE VARCHAR(5),
  LOCATION VARCHAR(100),
  CITY VARCHAR(50));

INSERT INTO CITY(STATE, LOCATION, CITY)
SELECT DISTINCT STATE, LOCATION, CITY FROM PROJ_STG;

CREATE TABLE ADDRESS (
  ADDRESS_ID SERIAL PRIMARY KEY,
  ADDRESS VARCHAR(200),
  CITY_ID INT REFERENCES CITY(CITY_ID)
);

INSERT INTO ADDRESS(ADDRESS, CITY_ID)
SELECT DISTINCT P.ADDRESS, C.CITY_ID FROM PROJ_STG P
JOIN CITY C ON C.CITY=P.CITY;


CREATE TABLE EDUCATION (
  EDUCATION_ID SERIAL,
  EDUCATION_LEVEL VARCHAR(50),
  PRIMARY KEY (EDUCATION_ID)
);

INSERT INTO EDUCATION(EDUCATION_LEVEL)
SELECT DISTINCT education_lvl FROM PROJ_STG;

CREATE TABLE EMPLOYEE (
  EMP_ID VARCHAR(10) PRIMARY KEY,
  HIRE_DT DATE,
  EMAIL VARCHAR(100),
  EMP_NM VARCHAR(100),
  EDUCATION_ID INT REFERENCES EDUCATION(EDUCATION_ID)
);

INSERT INTO EMPLOYEE(EMP_ID, HIRE_DT, EMAIL, EMP_NM, EDUCATION_ID)
SELECT DISTINCT P.EMP_ID, P.HIRE_DT, P.EMAIL, P.EMP_NM, E.EDUCATION_ID FROM PROJ_STG P
JOIN EDUCATION E ON E.EDUCATION_LEVEL=P.education_lvl;

CREATE TABLE SALARY (
  SALARY_ID SERIAL,
  SALARY FLOAT,
  EMP_ID VARCHAR(10),
  PRIMARY KEY (SALARY_ID, EMP_ID)
);

INSERT INTO SALARY(SALARY, EMP_ID) 
SELECT DISTINCT SALARY, EMP_ID FROM PROJ_STG;

CREATE TABLE EMPLOYEE_HISTORY (
  EMP_ID VARCHAR(10) REFERENCES EMPLOYEE(EMP_ID),
  JOB_TITLE VARCHAR(50),
  DEPARTMENT VARCHAR(50),
  MANAGER_ID VARCHAR(10),
  START_DT DATE,
  END_DT DATE,
  SALARY_ID INT,
  ADDRESS_ID INT  REFERENCES ADDRESS(ADDRESS_ID),
  PRIMARY KEY (EMP_ID, START_DT),
  FOREIGN KEY (EMP_ID, SALARY_ID) REFERENCES SALARY(EMP_ID, SALARY_ID)
);


